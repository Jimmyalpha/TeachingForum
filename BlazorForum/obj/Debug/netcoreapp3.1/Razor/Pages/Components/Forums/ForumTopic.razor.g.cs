#pragma checksum "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "8c3ad272f5974b6701b35fe6ae07cb3935dd4403"
// <auto-generated/>
#pragma warning disable 1591
namespace BlazorForum.Pages.Components.Forums
{
    #line hidden
    using System;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#line 1 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#line 2 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#line 3 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#line 4 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#line 5 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#line 6 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#line 7 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#line 9 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\_Imports.razor"
using BlazorForum;

#line default
#line hidden
#line 10 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\_Imports.razor"
using BlazorForum.Shared;

#line default
#line hidden
#line 11 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\_Imports.razor"
using BlazorForum.Models;

#line default
#line hidden
#line 12 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\_Imports.razor"
using Domain.Resources;

#line default
#line hidden
#line 13 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\_Imports.razor"
using BlazorForum.Domain.Interfaces;

#line default
#line hidden
#line 14 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\_Imports.razor"
using BlazorForum.Domain.Services;

#line default
#line hidden
#line 15 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\_Imports.razor"
using Domain.Utilities.Formatting;

#line default
#line hidden
#line 16 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\_Imports.razor"
using BlazorForum.Pages.Components.BlazorModal;

#line default
#line hidden
#line 17 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\_Imports.razor"
using BlazorForum.Pages.Components.BlazorModal.Components;

#line default
#line hidden
#line 18 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\_Imports.razor"
using BlazorForum.Pages.Components.Head;

#line default
#line hidden
#line 2 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
using Microsoft.AspNetCore.Identity;

#line default
#line hidden
#line 3 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
using System.Collections.Generic;

#line default
#line hidden
#line 4 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
using BlazorForum.Pages.Components.Forums.SubComponents;

#line default
#line hidden
    [Microsoft.AspNetCore.Components.RouteAttribute("/topic/{id:int}/{slug}")]
    public partial class ForumTopic : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
            __builder.OpenElement(0, "ul");
            __builder.AddAttribute(1, "class", "breadcrumb blazorforum-breadcrumb");
            __builder.AddMarkupContent(2, "\n        ");
            __builder.AddMarkupContent(3, "<li class=\"breadcrumb-item\">\n            <a href=\"/forums/\">Forums</a>\n        </li>\n        ");
            __builder.OpenElement(4, "li");
            __builder.AddAttribute(5, "class", "breadcrumb-item");
            __builder.AddMarkupContent(6, "\n");
#line 22 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
              
                var bc = _category != null && _category.Title != null ?
                String.Format("<a href=\"/category/{0}/{1}\">{2}</a>", _category.ForumCategoryId,
                Domain.Utilities.Formatting.UrlFormatting.PrepareUrlText(_category.ForumCategoryUrl), _category.Title) : "";
                

#line default
#line hidden
            __builder.AddContent(7, 
#line 26 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                  (MarkupString)bc

#line default
#line hidden
            );
            __builder.AddContent(8, "        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(9, "\n        ");
            __builder.OpenElement(10, "li");
            __builder.AddAttribute(11, "class", "breadcrumb-item");
            __builder.AddMarkupContent(12, "\n            ");
            __builder.AddContent(13, 
#line 30 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
              _topic != null && _topic.Title != null ? _topic.Title : ""

#line default
#line hidden
            );
            __builder.AddMarkupContent(14, "\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(15, "\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(16, "\n\n");
#line 34 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
 if (_topic == null)
{

#line default
#line hidden
            __builder.AddContent(17, "    ");
            __builder.OpenElement(18, "div");
            __builder.AddAttribute(19, "class", "mb-2 loading-div");
            __builder.AddMarkupContent(20, "\n        ");
            __builder.OpenElement(21, "em");
            __builder.AddMarkupContent(22, "<i class=\"oi oi-cog se-spin-icon\"></i> ");
            __builder.AddContent(23, 
#line 37 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                                                    GeneralResources.Loading

#line default
#line hidden
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(24, "\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(25, "\n");
#line 39 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
}
else
{

#line default
#line hidden
            __builder.OpenElement(26, "div");
            __builder.AddAttribute(27, "class", "text-right");
            __builder.AddMarkupContent(28, "\n");
#line 43 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
     if (CurrentUserId != null)
    {
        if (_userIsSubscribedToTopic)
        {

#line default
#line hidden
            __builder.AddContent(29, "            ");
            __builder.OpenElement(30, "button");
            __builder.AddAttribute(31, "class", "btn btn-sm btn-blazorforum mb-1");
            __builder.AddAttribute(32, "type", "button");
            __builder.AddAttribute(33, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#line 47 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                                                                                    (() => UnsubscribeUserFromTopic())

#line default
#line hidden
            ));
            __builder.AddAttribute(34, "title", "退订话题");
            __builder.AddMarkupContent(35, "退订");
            __builder.CloseElement();
            __builder.AddMarkupContent(36, "\n");
#line 48 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
        }
        else
        {

#line default
#line hidden
            __builder.AddContent(37, "            ");
            __builder.OpenElement(38, "button");
            __builder.AddAttribute(39, "class", "btn btn-sm btn-blazorforum mb-1");
            __builder.AddAttribute(40, "type", "button");
            __builder.AddAttribute(41, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#line 51 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                                                                                    (() => SubscribeUserToTopic())

#line default
#line hidden
            ));
            __builder.AddAttribute(42, "title", "订阅话题");
            __builder.AddMarkupContent(43, "订阅");
            __builder.CloseElement();
            __builder.AddMarkupContent(44, "\n");
#line 52 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
        }
    }

#line default
#line hidden
            __builder.CloseElement();
            __builder.AddMarkupContent(45, "\n    ");
            __builder.OpenElement(46, "header");
            __builder.AddAttribute(47, "class", "forum-topic-header");
            __builder.AddMarkupContent(48, "\n        ");
            __builder.OpenElement(49, "h3");
            __builder.AddContent(50, 
#line 56 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
             _topic.Title

#line default
#line hidden
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(51, "\n        ");
            __builder.OpenElement(52, "div");
            __builder.AddAttribute(53, "class", "forum-post-time d-inline-block");
            __builder.AddMarkupContent(54, "\n            Posted ");
            __builder.AddContent(55, 
#line 58 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                    Domain.Utilities.Formatting.DateTimeFormatting.RelativeDateAgo(_topic.PostedDate)

#line default
#line hidden
            );
            __builder.AddMarkupContent(56, "\n            by ");
            __builder.AddContent(57, 
#line 59 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                _topic.UserName

#line default
#line hidden
            );
            __builder.AddMarkupContent(58, "\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(59, "\n");
#line 61 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
         if (_topic.EditedDate != null)
        {

#line default
#line hidden
            __builder.AddContent(60, "            ");
            __builder.OpenElement(61, "div");
            __builder.AddAttribute(62, "class", "forum-post-time ml-3 d-inline-block");
            __builder.AddMarkupContent(63, "\n                Edited ");
            __builder.AddContent(64, 
#line 64 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                        DateTimeFormatting.RelativeDateAgo(Convert.ToDateTime(_topic.EditedDate))

#line default
#line hidden
            );
            __builder.AddMarkupContent(65, "\n            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(66, "\n");
#line 66 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
        }

#line default
#line hidden
            __builder.AddContent(67, "    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(68, "\n    ");
            __builder.OpenElement(69, "section");
            __builder.AddAttribute(70, "class", "forum-topic-text-section");
            __builder.AddMarkupContent(71, "\n        ");
            __builder.OpenComponent<BlazorForum.Pages.Components.Forums.SubComponents.Topic>(72);
            __builder.AddAttribute(73, "ThisTopic", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<BlazorForum.Models.ForumTopic>(
#line 69 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                           _topic

#line default
#line hidden
            ));
            __builder.AddAttribute(74, "ForumUpDownVoteEnabled", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<System.Boolean>(
#line 69 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                                                            _forumUpDownVoteEnabled

#line default
#line hidden
            ));
            __builder.AddAttribute(75, "CurrentUserId", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<System.String>(
#line 69 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                                                                                                     CurrentUserId

#line default
#line hidden
            ));
            __builder.CloseComponent();
            __builder.AddMarkupContent(76, "\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(77, "\n");
#line 71 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"

    if (_posts != null && _posts.Count > 0)
    {

#line default
#line hidden
            __builder.AddContent(78, "    ");
            __builder.OpenElement(79, "ul");
            __builder.AddAttribute(80, "class", "forum-post-ul");
            __builder.AddMarkupContent(81, "\n");
#line 75 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
         for(var i = 0; i < (_posts.Count); i++)
        {

#line default
#line hidden
            __builder.AddContent(82, "            ");
            __builder.OpenElement(83, "li");
            __builder.AddMarkupContent(84, "\n                ");
            __builder.OpenComponent<BlazorForum.Pages.Components.Forums.SubComponents.Post>(85);
            __builder.AddAttribute(86, "CurrentUserId", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<System.String>(
#line 78 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                                      CurrentUserId

#line default
#line hidden
            ));
            __builder.AddAttribute(87, "ForumUpDownVoteEnabled", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<System.Boolean>(
#line 78 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                                                                              _forumUpDownVoteEnabled

#line default
#line hidden
            ));
            __builder.AddAttribute(88, "ThisPost", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<BlazorForum.Models.ForumPost>(
#line 78 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                                                                                                                  _posts[i]

#line default
#line hidden
            ));
            __builder.AddAttribute(89, "ForumId", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<System.Int32>(
#line 78 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                                                                                                                                      _category.ForumCategoryId

#line default
#line hidden
            ));
            __builder.CloseComponent();
            __builder.AddMarkupContent(90, "\n            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(91, "\n");
#line 80 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
         }

#line default
#line hidden
            __builder.AddContent(92, "    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(93, "\n");
#line 82 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
    }


#line default
#line hidden
            __builder.AddContent(94, "    ");
            __builder.OpenElement(95, "div");
            __builder.AddAttribute(96, "class", "text-center");
            __builder.AddMarkupContent(97, "\n        ");
            __builder.OpenElement(98, "button");
            __builder.AddAttribute(99, "class", "btn" + " btn-blazorforum" + " " + (
#line 85 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                                            loadMoreVisibility

#line default
#line hidden
            ));
            __builder.AddAttribute(100, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#line 85 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                                                                          LoadMorePostsAsync

#line default
#line hidden
            ));
            __builder.AddContent(101, 
#line 85 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                                                                                               GeneralResources.LoadMore

#line default
#line hidden
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(102, "\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(103, "\n");
#line 87 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
}

#line default
#line hidden
            __builder.AddMarkupContent(104, "\n");
            __builder.OpenElement(105, "section");
            __builder.AddAttribute(106, "class", "mt-4 mb-3");
            __builder.AddMarkupContent(107, "\n    ");
            __builder.OpenElement(108, "h4");
            __builder.AddContent(109, 
#line 90 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
         GeneralResources.PostReply

#line default
#line hidden
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(110, "\n    ");
            __builder.OpenComponent<Microsoft.AspNetCore.Components.Authorization.AuthorizeView>(111);
            __builder.AddAttribute(112, "Authorized", (Microsoft.AspNetCore.Components.RenderFragment<Microsoft.AspNetCore.Components.Authorization.AuthenticationState>)((context) => (__builder2) => {
                __builder2.AddMarkupContent(113, "\n            ");
                __builder2.OpenComponent<BlazorForum.Pages.Components.Forums.PostForm>(114);
                __builder2.AddAttribute(115, "OnPostAdded", new System.Action(
#line 93 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                                   UpdatePostsAsync

#line default
#line hidden
                ));
                __builder2.AddAttribute(116, "TopicId", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<System.Int32>(
#line 93 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                                                               id

#line default
#line hidden
                ));
                __builder2.AddAttribute(117, "CurrentUserId", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<System.String>(
#line 93 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                                                                                   CurrentUserId

#line default
#line hidden
                ));
                __builder2.AddAttribute(118, "TopicSlug", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<System.String>(
#line 93 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                                                                                                              slug

#line default
#line hidden
                ));
                __builder2.CloseComponent();
                __builder2.AddMarkupContent(119, "\n        ");
            }
            ));
            __builder.AddAttribute(120, "NotAuthorized", (Microsoft.AspNetCore.Components.RenderFragment<Microsoft.AspNetCore.Components.Authorization.AuthenticationState>)((context) => (__builder2) => {
                __builder2.AddMarkupContent(121, "\n            ");
                __builder2.OpenElement(122, "div");
                __builder2.AddAttribute(123, "class", "alert alert-secondary");
                __builder2.AddMarkupContent(124, "\n                ");
                __builder2.OpenElement(125, "span");
                __builder2.AddAttribute(126, "class", "text-secondary");
                __builder2.AddContent(127, 
#line 97 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
                                              GeneralResources.MustLoginToPost

#line default
#line hidden
                );
                __builder2.CloseElement();
                __builder2.AddMarkupContent(128, "\n            ");
                __builder2.CloseElement();
                __builder2.AddMarkupContent(129, "\n        ");
            }
            ));
            __builder.CloseComponent();
            __builder.AddMarkupContent(130, "\n");
            __builder.CloseElement();
        }
        #pragma warning restore 1998
#line 104 "D:\CLASS\软件工程\大程\论坛\BlazorForum-new\BlazorForum\Pages\Components\Forums\ForumTopic.razor"
       
    [Parameter] public int id { get; set; }
    [Parameter] public string slug { get; set; }
    [Parameter] public string CurrentUserId { get; set; }
    private Models.ForumCategory _category;
    private Models.ForumTopic _topic;
    private List<Models.ForumPost> _posts;
    private int _maxCount = 10;
    private string loadMoreVisibility;
    private bool _forumUpDownVoteEnabled;
    private bool _userIsSubscribedToTopic;

    protected override async Task OnInitializedAsync()
    {
        await LoadTopicAsync();

        head.Title = _topic.Title;
        head.Description = _topic.TopicText;
        _posts = await manageForumPosts.GetApprovedForumPostsAsync(id);
        _category = await manageForumCategories.GetForumCategoryAsync(_topic.ForumCategoryId);
        var forum = await manageForums.GetForumAsync(_category.ForumId);
        _forumUpDownVoteEnabled = forum.EnableUpDownVotes;

        if (_maxCount >= _posts.Count)
            loadMoreVisibility = "d-none";

        _posts = _posts.Take(_maxCount).ToList();
        CurrentUserId = await new Domain.Utilities.Membership.UserInfo(userManager, authStateProvider).GetUserId();
        await AddUserToPostAsync();

        await CheckIfUserIsSubscribed();
    }

    private async Task LoadTopicAsync()
    {
        _topic = await manageForumTopics.GetForumTopicAsync(id);
        if(_topic == null || _topic.IsApproved != true || _topic.IsDeleted == true)
            navManager.NavigateTo("/");

        var user = await userManager.FindByIdAsync(_topic.UserId);
        _topic.UserName = user.UserName;
    }

    public async void UpdatePostsAsync()
    {
        _posts = await manageForumPosts.GetApprovedForumPostsAsync(id);

        if (_maxCount >= _posts.Count)
            loadMoreVisibility = "d-none";
        else
            loadMoreVisibility = "d-inline-block";

        _posts = _posts.Take(_maxCount).ToList();

        await AddUserToPostAsync();

        // Update the subscription button in upper right, since they are subscribed after adding a new post.
        await CheckIfUserIsSubscribed();

        StateHasChanged();
    }

    public async Task LoadMorePostsAsync()
    {
        _maxCount += 10;
        _posts = await manageForumPosts.GetApprovedForumPostsAsync(id);

        if (_maxCount >= _posts.Count)
            loadMoreVisibility = "d-none";
        else
            loadMoreVisibility = "d-inline-block";

        _posts = _posts.Take(_maxCount).ToList();

        await AddUserToPostAsync();
        StateHasChanged();
    }

    private async Task AddUserToPostAsync()
    {
        foreach (var post in _posts)
        {
            var user = await userManager.FindByIdAsync(post.UserId);
            post.UserName = user.UserName;
        }
    }

    private async Task CheckIfUserIsSubscribed()
    {
        _userIsSubscribedToTopic = await new Domain.Helpers.Forum.ForumTopicHelpers(manageTopicSubscriptions)
            .CurrentUserIsSubscribedToTopic(CurrentUserId, id);
    }

    private async Task UnsubscribeUserFromTopic()
    {
        await manageTopicSubscriptions.RemoveSubscriptionFromTopicAsync(id, CurrentUserId);
        await CheckIfUserIsSubscribed();
    }

    private async Task SubscribeUserToTopic()
    {
        var newSubscription = new TopicSubscription {
            Id = CurrentUserId,
            ForumTopicId = id
        };
        await manageTopicSubscriptions.AddSubscriptionToTopicAsync(newSubscription);
        await CheckIfUserIsSubscribed();
    }

#line default
#line hidden
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime JSRuntime { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private AuthenticationStateProvider authStateProvider { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private UserManager<ApplicationUser> userManager { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IManageTopicSubscriptions manageTopicSubscriptions { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IManageForums manageForums { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IManageForumPosts manageForumPosts { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IManageForumTopics manageForumTopics { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IManageForumCategories manageForumCategories { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager navManager { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private HeadBuilderService head { get; set; }
    }
}
#pragma warning restore 1591
